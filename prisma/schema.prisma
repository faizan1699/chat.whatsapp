generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           Int       @id @default(autoincrement())
  username     String    @unique
  email        String?   @unique
  phoneNumber  String?   @unique
  password     String
  avatar       String?
  lastSeen     DateTime  @default(now())
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  sentMessages Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
}

model Message {
  id             String   @id
  from           String
  to             String
  message        String   @default("")
  timestamp      DateTime @default(now())
  status         String   @default("sent") // pending, sent, delivered, read
  isVoiceMessage Boolean  @default(false)
  audioUrl       String?
  audioDuration  Float?
  isEdited       Boolean  @default(false)
  isDeleted      Boolean  @default(false)
  isPinned       Boolean  @default(false)
  replyTo        Json?    // Store partial message for reply
  groupId        String?  // For chunked messages
  chunkIndex     Int?
  totalChunks    Int?
  
  sender         User     @relation("SentMessages", fields: [from], references: [username])
  receiver       User     @relation("ReceivedMessages", fields: [to], references: [username])

  @@index([from])
  @@index([to])
}
